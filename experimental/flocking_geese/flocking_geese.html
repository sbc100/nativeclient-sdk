<!DOCTYPE html>
<html>
<head>
  <title>Flocking Geese Speed Comparison</title>
  <meta HTTP-EQUIV="Pragma" CONTENT="no-cache">
  <meta HTTP-EQUIV="Expires" CONTENT="-1">
  <link href="css/flocking_geese.css" rel="stylesheet" type="text/css">
  <link href="css/form_input.css" rel="stylesheet" type="text/css">
  <link href="css/info_panel.css" rel="stylesheet" type="text/css">
  <link href="css/load_progress.css" rel="stylesheet" type="text/css">
  <link href="css/slider.css" rel="stylesheet" type="text/css">
  <link href="css/speedometer.css" rel="stylesheet" type="text/css">

  <!-- <script src="closure-library/closure/goog/base.js"></script> -->
  <script type="text/javascript" src="js/closure.js"></script>
  <script type="text/javascript" src="js/check_browser.js"></script>
  <script type="text/javascript" src="js/flock.js"></script>
  <script type="text/javascript" src="js/flocking_geese.js"></script>
  <script type="text/javascript" src="js/frame_counter.js"></script>
  <script type="text/javascript" src="js/goose.js"></script>
  <script type="text/javascript" src="js/load_progress.js"></script>
  <script type="text/javascript" src="js/slider.js"></script>
  <script type="text/javascript" src="js/slider_event.js"></script>
  <script type="text/javascript" src="js/speedometer.js"></script>
  <script type="text/javascript">
    goog.require('Flock');
    goog.require('FlockingGeese');
    goog.require('FrameCounter');
    goog.require('Goose');
    goog.require('LoadProgress');
    goog.require('Slider');
    goog.require('SliderEvent');
    goog.require('Speedometer');
    goog.require('Speedometer.Attributes');
  </script>

  <script type="text/javascript">
    // Check for Native Client support in the browser.
    var isValidBrowser = false;
    var browserSupportStatus = 0;
    var checker = new browser_version.BrowserChecker(
        14,  // Minumum Chrome version.
        navigator["appVersion"],
        navigator["plugins"]);
    checker.checkBrowser();
    browserSupportStatus = checker.getBrowserSupportStatus();
    isValidBrowser = checker.getIsValidBrowser();

    // Resize the simulation canvas to fill its parent element.
    // @param {Event} e The resize event.
    window.onresize = function(e) {
      var geeseView = document.getElementById('flocking_geese');
      var viewSize = goog.style.getSize(geeseView);
      var gooseCanvas = document.getElementById('flocking_geese_canvas');
      gooseCanvas.width = viewSize.width;
      gooseCanvas.height = viewSize.height;
    }
  </script>

</head>
<body>
  <div id="autosize_background" class="autosize-view">
    <!-- The main simulation area.  This element contains either a <canvas> that
    get rendered by the JavaScript implementation, or a NaCl module that runs
    the C++ implementation. -->
    <div id="flocking_geese">
      <!-- The JavaScript version. -->
      <script type="text/javascript">
        var geeseView = document.getElementById('flocking_geese');
        var viewSize = goog.style.getSize(geeseView);
        // The JavaScripot <CANVAS>-based version.
        geeseView.innerHTML =
          '<canvas id="flocking_geese_canvas"' +
              ' width=' + viewSize.width +
              ' height=' + viewSize.height +
              '></canvas>' +
          // The C++ version.
          '<div id="nacl_flocking_geese"' +
              ' class="autosize-view"' +
              ' style="display: table; visibility: hidden;"></div>';
      </script>
    </div>
    <!-- The information panel. Contains these elements:
      1. The speedometer, which is a <canvas> and an implementation in
         speedometer.js
      2. A form that has a toggle button to switch between the JavaScript and
         C++ versions of the algorith, and a pulldown to set the number of
         geese.
      3. An info area for attributions and useful links.
    -->
    <div id="info_panel"
         style="display: inline;">
      <h2 style="margin-left: 16px; width: 100%;">Info Panel</h2>
      <canvas id="speedometer_canvas"
              class="horizontal-align-center"
              width=230
              height=230></canvas><br />
      <!-- Show the meter values. -->
      <table style="font-size: 10pt; margin-bottom: 1em;">
        <tr>
          <td align="right">NaCl:</td>
          <td id="naclMeterLabel">0.0</td>
        </tr>
        <tr>
          <td align="right">JS:</td>
          <td id="jsMeterLabel">0.0</td>
        </tr>
      </table>
      <form id="game_controls_form"
            action=""
            method="get">
        <p style="margin-left: 16px; margin-bottom: 0px">Simulation Mode</p>
        <p style="margin-left: 32px;">
          <input type="radio"
                 name="sim_mode_select"
                 value="JavaScript" checked></input>
          <span>JavaScript</span><br />
          <input id="nacl_radio_button"
                 type="radio"
                 name="sim_mode_select"
                 value="NaCl"></input>
          <span id="nacl_radio_label">Native Client</span>
        </p>
      </form>
      <p style="margin-left: 16px; margin-bottom: 0px;">Flock Size</p>
      <div id="flock_size_slider" class="kd-slider kd-slider-discrete">
        <ol id="flock_size_slider_ruler" class="kd-sliderruler">
          <li class="kd-sliderstep">20</li>
          <li class="kd-sliderstep">100</li>
          <li class="kd-sliderstep">500</li>
          <li class="kd-sliderstep">1000</li>
        </ol>
        <div id="flock_size_slider_thumb" class="kd-sliderhandle">
          <span class="kd-sliderhandle-inner">V</span>
        </div>
      </div>
      <p id="browser_status" style="margin-left: 16px;"></p>
    </div>
    <script type="text/javascript">
      if (!isValidBrowser) {
        var naclRadioButton = document.getElementById('nacl_radio_button');
        naclRadioButton.setAttribute('disabled', 'disabled');
        var naclRadioLabel = document.getElementById('nacl_radio_label');
        naclRadioLabel.style.color = 'lightgray';
      }
      var browserStatus = document.getElementById('browser_status');
      switch (browserSupportStatus) {
      case browser_version.BrowserChecker.StatusValues.NACL_ENABLED:
        break;
      case browser_version.BrowserChecker.StatusValues.UNKNOWN_BROWSER:
        browserStatus.innerHTML =
            '<strong>Native Client disabled.</strong><br />Native Client ' +
            'has been disabled because your browser does not ' +
            'support it.';
        break;
      case browser_version.BrowserChecker.StatusValues.CHROME_VERSION_TOO_OLD:
        browserStatus.innerHTML =
            '<strong>Native Client disabled.</strong><br />You are ' +
            'running a version of Chrome that is too old to support Native ' +
            'Client. Please use Chrome version 14 or later.<br />' +
    '<a href="http://www.google.com/chrome">http://www.google.com/chrome</a>';
        break;
      case browser_version.BrowserChecker.StatusValues.NACL_NOT_ENABLED:
        browserStatus.innerHTML =
            '<strong>Native Client disabled.</strong><br />Native Client is ' +
            'is not enabled.<br>' +
            'Please go to <b>chrome://plugins</b> and enable the Native ' +
            'Client plugin.';
        break;
      case browser_version.BrowserChecker.StatusValues.NOT_USING_SERVER:
        browserStatus.innerHTML =
            '<strong>Native Client disabled.</strong><br />' +
            'file:// URL detected, please use a web server to host Native ' +
            'Client applications.';
      default:
        browserStatus.innerHTML =
            '<strong>Native Client disabled.</strong><br />' +
            'Unknown error: Unable to detect browser and/or Native Client ' +
            'support.';
        break;
      }
      var application = new FlockingGeese();
      application.run('nacl_flocking_geese');
    </script>
  </div>
</body>
</html>
