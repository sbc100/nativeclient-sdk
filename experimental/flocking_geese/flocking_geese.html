<!DOCTYPE html>
<html>
  <!--
  Copyright (c) 2011 The Native Client Authors. All rights reserved.
  Use of this source code is governed by a BSD-style license that can be
  found in the LICENSE file.
  -->
<head>
  <title>Flocking Geese Speed Comparison</title>
  <meta HTTP-EQUIV="Pragma" CONTENT="no-cache">
  <meta HTTP-EQUIV="Expires" CONTENT="-1">
  <link href="css/flocking_geese.css" rel="stylesheet" type="text/css">
  <link href="css/form_input.css" rel="stylesheet" type="text/css">
  <link href="css/info_panel.css" rel="stylesheet" type="text/css">
  <link href="css/load_progress.css" rel="stylesheet" type="text/css">
  <link href="css/slider.css" rel="stylesheet" type="text/css">
  <link href="css/speedometer.css" rel="stylesheet" type="text/css">

  <!-- <script src="closure-library/closure/goog/base.js"></script> -->
  <script type="text/javascript" src="js/closure.js"></script>
  <script type="text/javascript" src="js/check_browser.js"></script>
  <script type="text/javascript" src="js/flock.js"></script>
  <script type="text/javascript" src="js/flocking_geese.js"></script>
  <script type="text/javascript" src="js/frame_counter.js"></script>
  <script type="text/javascript" src="js/goose.js"></script>
  <script type="text/javascript" src="js/load_progress.js"></script>
  <script type="text/javascript" src="js/slider.js"></script>
  <script type="text/javascript" src="js/slider_event.js"></script>
  <script type="text/javascript" src="js/speedometer.js"></script>
  <script type="text/javascript">
    goog.require('Flock');
    goog.require('FlockingGeese');
    goog.require('FrameCounter');
    goog.require('Goose');
    goog.require('LoadProgress');
    goog.require('Slider');
    goog.require('SliderEvent');
    goog.require('Speedometer');
    goog.require('Speedometer.Attributes');
  </script>

  <script type="text/javascript">
    // Check for Native Client support in the browser.
    var isValidBrowser = false;
    var browserSupportStatus = 0;
    var checker = new browser_version.BrowserChecker(
        14,  // Minumum Chrome version.
        navigator["appVersion"],
        navigator["plugins"]);
    checker.checkBrowser();
    browserSupportStatus = checker.getBrowserSupportStatus();
    isValidBrowser = checker.getIsValidBrowser();

    // Resize the simulation canvas to fill its parent element.
    // @param {Event} e The resize event.
    window.onresize = function(e) {
      var geeseView = document.getElementById('flocking_geese');
      var viewSize = goog.style.getSize(geeseView);
      var gooseCanvas = document.getElementById('flocking_geese_canvas');
      gooseCanvas.width = viewSize.width;
      gooseCanvas.height = viewSize.height;
    }
  </script>

</head>
<body>
  <div id="autosize_background" class="autosize-view">
    <!-- The main simulation area.  This element contains either a <canvas> that
    get rendered by the JavaScript implementation, or a NaCl module that runs
    the C++ implementation. -->
    <div id="flocking_geese">
      <!-- The JavaScript version. -->
      <script type="text/javascript">
        var geeseView = document.getElementById('flocking_geese');
        var viewSize = goog.style.getSize(geeseView);
        geeseView.innerHTML =
          // The JavaScript <CANVAS>-based version.
          '<canvas id="flocking_geese_canvas"' +
              ' width=' + viewSize.width +
              ' height=' + viewSize.height +
              '></canvas>' +
          // The C++ Native Client-based version.
          '<div id="nacl_flocking_geese"' +
              ' class="autosize-view"' +
              ' style="display: table; visibility: hidden;"></div>';
      </script>
    </div>
    <!-- The information panel. Contains these elements:
      1. The speedometer, which is a <canvas> and an implementation in
         speedometer.js
      2. A form that has a toggle button to switch between the JavaScript and
         C++ versions of the algorith, and a pulldown to set the number of
         geese.
      3. An info area for attributions and useful links.
    -->
    <div id="info_panel"
         style="display: inline;">
      <h2 style="width: 100%;">Info Panel</h2>
      <canvas id="speedometer_canvas"
              class="horizontal-align-center"
              width=250 height=225></canvas>
      <div id="sim_mode_select" class="slider">
        <img id="sim_select_ruler"
             src="images/sim_select_ruler.png"
             class="slider-ruler"
             width=116 height=24 />
        <img id="sim_select_thumb"
             src="images/slider_thumb.png"
             class="slider-thumb"
             width=9 height=23 />
      </div>
      <div id="flock_size_slider" class="slider">
        <img id="flock_size_slider_ruler"
             src="images/flock_size_ruler.png"
             class="slider-ruler"
             width=156 height=28 />
        <img id="flock_size_slider_thumb"
             src="images/slider_thumb.png"
             class="slider-thumb"
             width=9 height=23 />
      </div>
      <!-- Show the speed difference. -->
      <p style="position: absolute; top:368px;">Speed difference:
        <span id="speed_difference"
              style="font-style: italic">Computing&hellip;</span>
      </p>
      <p id="browser_status"></p>
      <div style="position: absolute; bottom: 16px;">
        <p style="margin-bottom: 0px;"><a href="about.html"
            target="about_flocking_geese">Acknowledgments</a></p>
        <p style="margin-bottom: 0px;"><a href="about.html"
            target="about_flocking_geese">Notices</a></p>
      </div>
    </div>
    <script type="text/javascript">
      if (!isValidBrowser) {
        var naclRadioButton = document.getElementById('nacl_radio_button');
        naclRadioButton.setAttribute('disabled', 'disabled');
        var naclRadioLabel = document.getElementById('nacl_radio_label');
        naclRadioLabel.style.color = 'lightgray';
      }
      var browserStatus = document.getElementById('browser_status');
      switch (browserSupportStatus) {
      case browser_version.BrowserChecker.StatusValues.NACL_ENABLED:
        break;
      case browser_version.BrowserChecker.StatusValues.UNKNOWN_BROWSER:
        browserStatus.innerHTML =
            '<strong>Native Client disabled.</strong><br />Native Client ' +
            'has been disabled because your browser does not support it. ' +
            'To learn more about Native Client, please visit:<br/>' +
'<a href="http://code.google.com/chrome/nativeclient/">http://code.google.com/chrome/nativeclient/</a> ';
        break;
      case browser_version.BrowserChecker.StatusValues.CHROME_VERSION_TOO_OLD:
        browserStatus.innerHTML =
            '<strong>Native Client disabled.</strong><br />You are ' +
            'running a version of Chrome that is too old to support Native ' +
            'Client. Please use Chrome version 14 or later.<br />' +
    '<a href="http://www.google.com/chrome">http://www.google.com/chrome</a>';
        break;
      case browser_version.BrowserChecker.StatusValues.NACL_NOT_ENABLED:
        browserStatus.innerHTML =
            '<strong>Native Client disabled.</strong><br />Native Client is ' +
            'is not enabled.<br>' +
            'Please go to <b>chrome://plugins</b> and enable the Native ' +
            'Client plugin.';
        break;
      case browser_version.BrowserChecker.StatusValues.NOT_USING_SERVER:
        browserStatus.innerHTML =
            '<strong>Native Client disabled.</strong><br />' +
            'file:// URL detected, please use a web server to host Native ' +
            'Client applications.';
      default:
        browserStatus.innerHTML =
            '<strong>Native Client disabled.</strong><br />' +
            'Unknown error: Unable to detect browser and/or Native Client ' +
            'support.';
        break;
      }
      var application = new FlockingGeese();
      application.run('nacl_flocking_geese');
    </script>
  </div>
</body>
</html>
